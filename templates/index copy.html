{% extends 'base.html' %}

{% block title %}CCTV Lalu Lintas Sumedang{% endblock %}

{% block content %}

<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<div class="hero-section">
    <div class="hero-content">
        <h1>Pantau CCTV <br> Lalu Lintas Sumedang <br> Terklasifikasi</h1>

        <p>Solusi cepat untuk memantau kondisi lalu lintas Sumedang secara langsung, aman, dan terkendali dengan
            teknologi Artificial Intelligent.</p>

        <a href="#galeri-cctv" class="btn-cyan">Lihat CCTV →</a>
    </div>
</div>

<div class="openmap">
    <div class="container my-5">
        <h2 class="section-title">CCTV Lalu Lintas Terklasifikasi</h2>
        <div id="map" style="height: 400px; border-radius: 15px;"></div>
    </div>
</div>

<div class="container gallery-section">
    <section id="galeri-cctv" class="container mt-5 py-5">

        <div class="cctv-grid-container">
            {% for id, data in cctv_list.items() %}
            <div class="cctv-card">

                <div class="card-thumbnail">
                    <img src="{{ url_for('static', filename='images/thumbnail/' + data.thumbnail) }}"
                        alt="thumbnail {{ data.nama }}" />

                    <a href="{{ url_for('cctv_view', cctv_id=id) }}" class="play-button">
                        <svg width="60" height="60" viewBox="0 0 60 60">
                            <ellipse class="play-button-bg" cx="30" cy="30" rx="30" ry="30" />
                            <polygon class="play-button-icon" points="25,20 40,30 25,40" />
                        </svg>
                    </a>
                </div>


                <h5 class="card-title">{{ data.nama }}</h5>
            </div>{% endfor %}
    </section>
</div>

<section id="galeri-cctv" class="container my-5">
</section>

<script>
    // Inisialisasi peta dan atur tampilan awal ke Sumedang
    var map = L.map('map').setView([-6.83, 107.92], 13); // Koordinat tengah Sumedang

    // Tambahkan layer peta dari OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Ambil data CCTV dari Flask dan ubah menjadi objek JavaScript
    var cctvData = {{ cctv_list|tojson|safe }};

    // Loop melalui setiap CCTV dan tambahkan penanda (marker) di peta
    for (const [id, data] of Object.entries(cctvData)) {
        if (data.lat && data.lon) {
            var marker = L.marker([data.lat, data.lon]).addTo(map);

            // Tambahkan pop-up yang muncul saat marker diklik
            marker.bindPopup(`<b>${data.nama}</b><br><a href="/cctv/${id}">Lihat Detail</a>`);
        }
    }
</script>

</html>

{% endblock %}